var p=(o,e)=>()=>(e||o((e={exports:{}}).exports,e),e.exports);var m=p((y,d)=>{(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const t of document.querySelectorAll('link[rel="modulepreload"]'))n(t);new MutationObserver(t=>{for(const s of t)if(s.type==="childList")for(const i of s.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&n(i)}).observe(document,{childList:!0,subtree:!0});function r(t){const s={};return t.integrity&&(s.integrity=t.integrity),t.referrerPolicy&&(s.referrerPolicy=t.referrerPolicy),t.crossOrigin==="use-credentials"?s.credentials="include":t.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function n(t){if(t.ep)return;t.ep=!0;const s=r(t);fetch(t.href,s)}})();const l={SN:{name:"Sénégal",regex:/^7[05678]\d{7}$/,example:"770123456"},FR:{name:"France",regex:/^(\+33|0)[67]\d{8}$/,example:"0612345678"},US:{name:"USA",regex:/^(\+1)?[2-9]\d{2}[2-9]\d{2}\d{4}$/,example:"4155551234"}};document.getElementById("loginForm").addEventListener("submit",async o=>{o.preventDefault();try{const e=document.getElementById("phone").value.trim(),r=document.getElementById("country").value,n="https://projet-json-server-3.onrender.com";let t;if(window.location.hostname.endsWith("vercel.app")){const s=await fetch(`${n}/users?phone=${e}&country=${r}`,{headers:{Accept:"application/json","Content-Type":"application/json"}});if(!s.ok)throw new Error(`HTTP error! status: ${s.status}`);const i=await s.json();if(i.length===0){c("Ce numéro n'existe pas dans la base pour ce pays.","error");return}const a=await fetch(`${n}/sessions`,{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({userId:i[0].id,phone:e,country:r,createdAt:new Date().toISOString()})});if(!a.ok){const u=await a.text();c(u||"Erreur lors de la création de la session","error");return}t=await a.json()}else{const s=await fetch(`${n}/users?phone=${e}&country=${r}`,{headers:{Accept:"application/json","Content-Type":"application/json"}});if(!s.ok)throw new Error(`HTTP error! status: ${s.status}`);const i=await s.json();if(i.length===0){c("Ce numéro n'existe pas dans la base pour ce pays.","error");return}const a=await fetch("/api/sessions",{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({userId:i[0].id,phone:e,country:r,createdAt:new Date().toISOString()})});if(!a.ok){const u=await a.text();if(console.error("Server response:",u),a.status===403){c("Impossible de créer une session sur la version déployée (lecture seule).","error");return}throw new Error("Erreur lors de la création de la session")}t=await a.json()}c("Connexion réussie ! Redirection...","success"),setTimeout(()=>{window.location.href=`/chat.html?sessionId=${t.id||t._id}`},1500)}catch(e){console.error("Error:",e),c(e.message||"Erreur de connexion au serveur. Veuillez réessayer.","error")}});function c(o,e){const r=document.getElementById("message"),n={error:"bg-red-500/20 text-red-400 border-red-500/30",success:"bg-green-500/20 text-green-400 border-green-500/30",info:"bg-blue-500/20 text-blue-400 border-blue-500/30",warning:"bg-yellow-500/20 text-yellow-400 border-yellow-500/30"};r.textContent=o,r.className=`mt-6 text-center p-4 rounded-xl border transition-all duration-300 ${n[e]||n.info}`,r.classList.remove("hidden"),r.style.opacity="0",r.style.transform="translateY(10px)",setTimeout(()=>{r.style.opacity="1",r.style.transform="translateY(0)"},10),e==="error"&&setTimeout(()=>{r.style.opacity="0",setTimeout(()=>{r.classList.add("hidden")},300)},5e3)}document.addEventListener("DOMContentLoaded",function(){const o=document.getElementById("phone"),e=document.getElementById("country");e.addEventListener("change",function(){const n=this.value,t=l[n];t&&(o.placeholder=`Ex: ${t.example}`,o.setAttribute("pattern",t.regex.source))}),o.addEventListener("input",function(){let n=this.value.replace(/\D/g,"");const t=e.value,s=l[t];s&&s.maxLength&&(n=n.substring(0,s.maxLength)),this.value=n}),o.addEventListener("blur",function(){const n=this.value.trim(),t=e.value,s=l[t];n&&!s.regex.test(n)?(this.classList.add("border-red-500","focus:ring-red-500"),this.classList.remove("border-slate-600","focus:ring-whatsapp-green")):(this.classList.remove("border-red-500","focus:ring-red-500"),this.classList.add("border-slate-600","focus:ring-whatsapp-green"))});const r=l[e.value];r&&(o.placeholder=`Ex: ${r.example}`)});document.addEventListener("keydown",function(o){if(o.ctrlKey&&o.key==="Enter"&&document.getElementById("loginForm").dispatchEvent(new Event("submit")),o.key==="Escape"){const e=document.getElementById("message");e.classList.contains("hidden")||(e.style.opacity="0",setTimeout(()=>{e.classList.add("hidden")},300))}});typeof d<"u"&&d.exports&&(d.exports={showMessage:c})});export default m();
